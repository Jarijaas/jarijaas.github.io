<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=author content><meta name=description content><meta name=keywords content><meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1"><meta name=generator content="Hugo 0.61.0"><link rel=canonical href=https://jarijaas.github.io/posts/otw-advent-2019/tiny-runes/><meta property="og:title" content="tiny runes"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://jarijaas.github.io/posts/otw-advent-2019/tiny-runes/"><meta property="article:published_time" content="2019-12-26T00:00:00+00:00"><meta property="article:modified_time" content="2019-12-26T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="tiny runes"><meta name=twitter:description content><meta itemprop=name content="tiny runes"><meta itemprop=description content><meta itemprop=datePublished content="2019-12-26T00:00:00+00:00"><meta itemprop=dateModified content="2019-12-26T00:00:00+00:00"><meta itemprop=wordCount content="395"><meta itemprop=keywords content="OTW Advent 2019,reversing,game,"><link rel=stylesheet href=https://jarijaas.github.io/css/layout.css><meta name=google-site-verification content="nu0v-SCw_KrBgDmtYoXUOIcoA61aEw2YLQ7PxQoS2QM"><link rel=stylesheet href=https://jarijaas.github.io/css/default-dark.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/jarijaas.github.io\/"},"articleSection":"posts","name":"tiny runes","headline":"tiny runes","description":"","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2019","datePublished":"2019-12-26 00:00:00 \x2b0000 UTC","dateModified":"2019-12-26 00:00:00 \x2b0000 UTC","url":"https:\/\/jarijaas.github.io\/posts\/otw-advent-2019\/tiny-runes\/","wordCount":"395","keywords":["OTW Advent 2019","reversing","game","Blog"]}</script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-154923689-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><title>tiny runes</title></head><body><div class=main><header><div class=header-bar><nav><div class=siteTitle><a href=https://jarijaas.github.io/>CTF writeups</a></div></nav><div class=social-links-header></div></div></header><article class=post><h1 class=title>tiny runes</h1><div class=content><p><img src=img/2019-12-18-20-20-13.png alt></p><p>The objective is to decode
the message in the <code>lines4.bin</code>
by reverse engineering the file format.</p><p>By opening the <code>lines4.bin</code>
in hex editor, we can see
that it contains the magic header <code>\x89PNG</code>
at offset <code>0x24</code>,
thus it contains a PNG image.</p><p><img src=img/2019-12-18-20-24-04.png alt></p><p>The image can be carved
by removing the preceeding bytes:</p><p><img src=img/2019-12-18-20-27-07.png alt></p><p>This image seems to be a character set.
The charset is the same in every <code>bin</code> file.</p><p>After removing the image data, we are left with the following bytes (<code>lines1.bin</code>):
<img src=img/2019-12-18-20-29-41.png alt></p><p>The following decoded lines were provided by the author for <code>lines1.bin</code>:</p><p><img src=img/2019-12-18-20-30-40.png alt></p><p>The <code>LiNe</code> seems to be the line data structure header.
The four next bytes is the line size: <code>00 00 00 3C</code>.</p><p>By looking at the decoded data and
similarly repeating bytes in the encoded
data, one can see that bytes <code>05 09</code> correspond to <code>dot</code>.</p><p>By looking at the charset image, <code>05</code> seems to be the column
and <code>09</code> is the row.</p><p>Now the <code>lines4.bin</code>
can be decoded
by converting
the image to
a 2D list and by using the <code>LiNe</code> header to locate the line data:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=color:#f92672>import</span> struct

filename <span style=color:#f92672>=</span> <span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>lines4.bin</span><span style=color:#e6db74>&#34;</span>

data <span style=color:#f92672>=</span> None

<span style=color:#66d9ef>with</span> open(filename, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>rb</span><span style=color:#e6db74>&#39;</span>) <span style=color:#66d9ef>as</span> f:
  data <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>read()


LINE_HDR <span style=color:#f92672>=</span> <span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>LiNe</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>encode(<span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>utf-8</span><span style=color:#e6db74>&#34;</span>)

<span style=color:#75715e># For each row</span>
CHARSET <span style=color:#f92672>=</span> [
  [<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>Q</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>?</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>0</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>H</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>$</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>Y</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>,</span><span style=color:#e6db74>&#39;</span>],
  [<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>R</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>-</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>L</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>^</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>K</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>J</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>k</span><span style=color:#e6db74>&#39;</span>],
  [<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>s</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>#</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>_</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>/</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>m</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>=</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>9</span><span style=color:#e6db74>&#39;</span>],
  [<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>7</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>d</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>-</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>N</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>E</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>4</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>q</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;</span>],
  [<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>P</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>i</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>V</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>`</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>&amp;</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>X</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>A</span><span style=color:#e6db74>&#39;</span>],
  [<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>n</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>3</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>I</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>O</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>*</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>;</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>Z</span><span style=color:#e6db74>&#39;</span>],
  [<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>w</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>G</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>p</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>B</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>8</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>c</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>S</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>j</span><span style=color:#e6db74>&#39;</span>],
  [<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>F</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>g</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>:</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>e</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>y</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>v</span><span style=color:#e6db74>&#39;</span>],
  [<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>%</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>+</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>1</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74> </span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>!</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>M</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>©</span><span style=color:#e6db74>&#39;</span>],
  [<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>h</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>2</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>x</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>W</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>.</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>D</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>],
  [<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>t</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>U</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>|</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>C</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>T</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>z</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>6</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;</span>],
  [<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>|</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>o</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>&gt;</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>a</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>5</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>l</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>&lt;</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>&#39;</span>]
]

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>parse_line</span>(line_bytes):
  line_len <span style=color:#f92672>=</span> struct<span style=color:#f92672>.</span>unpack(<span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>&gt;I</span><span style=color:#e6db74>&#34;</span>, line_bytes[:<span style=color:#ae81ff>4</span>])[<span style=color:#ae81ff>0</span>]
  <span style=color:#75715e># print(&#34;Line len: %d&#34; % line_len)</span>
  idx <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>
  line <span style=color:#f92672>=</span> <span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#66d9ef>while</span> idx <span style=color:#f92672>&lt;</span><span style=color:#f92672>=</span> (line_len <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>):
    col <span style=color:#f92672>=</span> line_bytes[idx]
    row <span style=color:#f92672>=</span> line_bytes[idx<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>]
    <span style=color:#75715e># print(&#34;%d, %d&#34; % (col, row))</span>
    char <span style=color:#f92672>=</span> CHARSET[row][col]
    line <span style=color:#f92672>+</span><span style=color:#f92672>=</span> char
    idx <span style=color:#f92672>+</span><span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
  <span style=color:#66d9ef>return</span> line

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_lines</span>(data):
  line_offsets <span style=color:#f92672>=</span> []
  <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(data)):
    current_hdr <span style=color:#f92672>=</span> data[i:i<span style=color:#f92672>+</span><span style=color:#ae81ff>4</span>]
    <span style=color:#66d9ef>if</span> current_hdr <span style=color:#f92672>==</span> LINE_HDR:
      line_offsets<span style=color:#f92672>.</span>append(i <span style=color:#f92672>+</span> <span style=color:#ae81ff>4</span>)
  <span style=color:#66d9ef>return</span> line_offsets


lines <span style=color:#f92672>=</span> find_lines(data)

<span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> lines:
  <span style=color:#66d9ef>print</span>(parse_line(data[line:]))
</code></pre></div><p>The flag is:</p><pre><code>Jock: &quot;0h my God! JC! A flag!&quot;
JC Denton: &quot;A flag! AOTW{wh4t_4_r0tt3n_fi13_f0rm4t}&quot;
</code></pre></div><footer class=post-footer><div class=post-footer-data><div class=tags><div class=tag><a href=https://jarijaas.github.io/tags/otw-advent-2019>#OTW Advent 2019</a></div><div class=tag><a href=https://jarijaas.github.io/tags/reversing>#reversing</a></div><div class=tag><a href=https://jarijaas.github.io/tags/game>#game</a></div></div><div class=date>26 Dec 2019</div></div></footer><script src=https://utteranc.es/client.js repo=Jarijaas/jarijaas.github.io issue-term=pathname theme=dark-blue crossorigin=anonymous async></script></article><footer><div class=social-links-footer><div class=social-link><a href=https://jarijaas.github.io/index.xml target=_blank>RSS</a></div></div><div class=copyright></div><div class=poweredby>Powered by <a href=https://gohugo.io/>Hugo</a>.</div></footer></div></body></html>